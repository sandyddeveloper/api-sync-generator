// Auto-generated by api-sync-generator
// Do not edit directly
import type * as Types from './types';

const BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:8000";

async function fetchApi<T>(path: string, options: RequestInit = {}): Promise<T> {
  const response = await fetch(`${BASE_URL}${path}`, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
  });

  if (!response.ok) {
    const errorData = await response.json().catch(() => ({}));
    throw new Error(errorData.detail || errorData.message || 'API request failed');
  }
  
  // Explicitly check for 204 No Content
  if (response.status === 204) {
    return {} as T;
  }

  return response.json();
}

{% for endpoint in endpoints %}
{% set has_params = endpoint.url_params | length > 0 or endpoint.query_params | length > 0 or endpoint.request_body_type %}

/**
{% if endpoint.summary %} * {{ endpoint.summary }}
{% endif %}{% if endpoint.description %} * {{ endpoint.description }}
{% endif %} *
{% for p in endpoint.url_params %} * @param params.{{ p.name }} {{ p.description or p.name }}
{% endfor %}{% for p in endpoint.query_params %}{% set qname = p.name.replace('?', '') %} * @param params.{{ qname }} {{ p.description or qname }}
{% endfor %}{% if endpoint.request_body_type %} * @param params.data Request body
{% endif %} */
export async function {{ endpoint.operation_id }}(
  {% if has_params %}
  params: {
    {% for p in endpoint.url_params %}
    {{ p.name }}: {{ p.type }};
    {% endfor %}
    {% for p in endpoint.query_params %}
    {{ p.name }}: {{ p.type }};
    {% endfor %}
    {% if endpoint.request_body_type %}
    data: Types.{{ endpoint.request_body_type }};
    {% endif %}
  }
  {% endif %}
): Promise<{{ 'Types.' ~ endpoint.response_body_type if endpoint.response_body_type else 'void' }}> {
  
  {% set url_path = endpoint.path %}
  {% for p in endpoint.url_params %}
  {% set url_path = url_path.replace('{' ~ p.name ~ '}', '${params.' ~ p.name ~ '}') %}
  {% endfor %}
  
  let url = `{{ url_path }}`;
  
  {% if endpoint.query_params | length > 0 %}
  const searchParams = new URLSearchParams();
  {% for p in endpoint.query_params %}
  {% set qname = p.name.replace('?', '') %}
  if (params.{{ qname }} !== undefined) {
    searchParams.append('{{ qname }}', String(params.{{ qname }}));
  }
  {% endfor %}
  const queryString = searchParams.toString();
  if (queryString) {
    url += `?${queryString}`;
  }
  {% endif %}

  return fetchApi(url, {
    method: '{{ endpoint.method }}',
    {% if endpoint.request_body_type %}
    body: JSON.stringify(params.data),
    {% endif %}
  });
}
{% endfor %}
